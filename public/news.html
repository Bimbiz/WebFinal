<!doctype html>
<html>
  <head>
    <title>Gaming News</title>
    <link rel="stylesheet" href="style.css" />
  </head>

  <body>
    <div style="margin-bottom: 20px">
      <a href="index.html">Games</a> | <a href="news.html">News</a> |
      <a href="login.html">Login</a>
    </div>
    <div class="container">
      <h1>Gaming News</h1>

      <input id="search" placeholder="Search gaming news..." />
      <button id="searchBtn" onclick="loadNews()">Search</button>

      <div id="news"></div>
    </div>

    <script>
      async function loadNews() {
        const newsDiv = document.getElementById("news");

        try {
          newsDiv.innerHTML = "<p>Loading...</p>";

          const query = document.getElementById("search")?.value || "";

          let url = "http://localhost:5000/api/news";

          if (query) {
            url += `?search=${encodeURIComponent(query)}`;
          }

          const res = await fetch(url);

          if (!res.ok) {
            throw new Error("Server error: " + res.status);
          }

          const data = await res.json();

          console.log(data);

          const articles = data.articles || data.data || data.results || [];

          newsDiv.innerHTML = "";

          if (articles.length === 0) {
            newsDiv.innerHTML = "<p>No news found.</p>";
            return;
          }

          articles.forEach((article) => {
            newsDiv.innerHTML += `
        <div class="card">
            <h3>${article.title || "No title"}</h3>
            <p>${article.source?.name || ""}</p>
            <a href="${article.url}" target="_blank">Read more</a>
        </div>
      `;
          });
        } catch (err) {
          console.error(err);

          newsDiv.innerHTML = `
      <p style="color:red;">
        Failed to load news. Check backend.
      </p>
    `;
        }
      }

      loadNews();
    </script>
  </body>
</html>
